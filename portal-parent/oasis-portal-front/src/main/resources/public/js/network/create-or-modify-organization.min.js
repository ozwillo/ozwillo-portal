function getSectorTypeLabel(sector_type,type_restriction){return type_restriction&&(type_restriction.company?type_restriction.public_body||(sector_type="COMPANY"):sector_type="PUBLIC_BODY"),"COMPANY"===sector_type?t("search.organization.sector-type.COMPANY"):t("search.organization.sector-type.PUBLIC_BODY")}var default_org_data={organization:{exist:!1,legal_name:"",sector_type:"",in_activity:!0,alt_name:"",org_type:"",tax_reg_num:"",tax_reg_ofical_id:"",tax_reg_activity_uri:"",jurisdiction_uri:"",jurisdiction:"",phone_number:"",web_site:"",email:"",street_and_number:"",additional_address_field:"",po_box:"",city:"",city_uri:"",zip:"",cedex:"",country_uri:""},errors:[[],[]],typeRestriction:""},CreateOrModifyOrganizationModal=React.createClass({displayName:"CreateOrModifyOrganizationModal",getInitialState:function(){return default_org_data},componentDidMount:function(){$(this.refs.modalcreateOrModifyOrg.getDOMNode()).on("shown.bs.modal",function(){$("input",this).first().focus()})},show:function(org){if(org){var state=this.state;state.organization=org,this.setState(state)}this.refs.modalcreateOrModifyOrg.open()},close:function(org){this.refs.modalcreateOrModifyOrg.close(),this.props.successHandler&&this.props.successHandler(org)},onError:function(data){this.refs.modalError.open()},createOrModifOrg:function(event){return this.refs.tabbedForm.createOrModifOrg(event)},render:function(){var org=this.state.organization,typeRestriction=this.props.typeRestriction,saveButton=org.exist?t("ui.save"):t("my.network.create-org"),buttonLabels={cancel:t("ui.cancel"),save:saveButton},modalTitle=org.exist?t("my.network.modify-org"):t("my.network.create-org");return React.createElement("div",null,React.createElement(Modal,{large:!0,ref:"modalcreateOrModifyOrg",title:modalTitle,successHandler:this.createOrModifOrg,buttonLabels:buttonLabels},React.createElement(CreateOrModifyOrganizationForm,{ref:"tabbedForm",successHandler:this.close,errorHandler:this.onError,organization:org,typeRestriction:typeRestriction})),React.createElement(Modal,{ref:"modalError",title:t("ui.something_went_wrong_title"),infobox:!0,cancelHandler:null},React.createElement("div",null,React.createElement("h5",null,t("ui.unexpected_error"))),React.createElement("br",null),React.createElement("div",null,React.createElement("h5",null,"Err: Possibly the organization is already assigned in kernel"))))}}),CreateOrModifyOrganizationForm=React.createClass({displayName:"CreateOrModifyOrganizationForm",getDefaultProps:function(){return{organization:default_org_data.organization,errors:default_org_data.errors}},getInitialState:function(){return{organization:this.props.organization,errors:default_org_data.errors,activeTab:1}},switchTab:function(idx){this.refs.navtab.changeTab({id:idx})},validateFields:function(org){var errors=[],errTab1=[];org.legal_name&&""!=org.legal_name.trim()||errTab1.push("legal_name"),org.tax_reg_num&&""!=org.tax_reg_num.trim()||errTab1.push("tax_reg_num"),"PUBLIC_BODY"!==org.sector_type||org.jurisdiction_uri&&""!=org.jurisdiction_uri.trim()||errTab1.push("jurisdiction_uri"),errors.push(errTab1);var errTab2=[];return org.street_and_number&&""!=org.street_and_number.trim()||errTab2.push("street_and_number"),org.zip&&""!=org.zip.trim()||errTab2.push("zip"),org.city_uri&&""!=org.city_uri.trim()||(errTab2.push("city_uri"),errTab2.push("city")),org.exist||org.country_uri&&""!=org.country_uri.trim()||(errTab2.push("country_uri"),errTab2.push("country")),errors.push(errTab2),this.setState({errors:errors}),errors},callCreateOrganization:function(org){$.ajax({url:network_service+"/create-dc-organization",type:"post",contentType:"application/json",data:JSON.stringify(org),success:function(data){data||""!==data?this.props.successHandler(data):this.props.errorHandler(data)}.bind(this),error:function(xhr,status,err){this.props.errorHandler()}.bind(this)})},callUpdateOrganization:function(org){$.ajax({url:network_service+"/update-dc-organization",type:"post",contentType:"application/json",data:JSON.stringify(org),success:function(data){data?this.props.successHandler(data):this.props.errorHandler(data)}.bind(this),error:function(xhr,status,err){this.props.errorHandler()}.bind(this)})},createOrModifOrg:function(event){event&&event.preventDefault();var org=this.props.organization,errs=this.validateFields(org);return errs[0].length+errs[1].length>0?(errs[0].length>0?this.switchTab(1):this.switchTab(2),!1):(org.exist?this.callUpdateOrganization(org):this.callCreateOrganization(org),this.switchTab(1),this.props.successHandler&&this.props.successHandler(),!0)},render:function(){var tabList=[{id:1,name:t("my.network.organization.tab1.general_information"),url:"#"},{id:2,name:t("my.network.organization.tab2.address_geolocation"),url:"#"}],organization=this.props.organization;return React.createElement("div",{className:"form-horizontal"},React.createElement(NavTab,{ref:"navtab",tabList:tabList,currentTab:this.state.activeTab},React.createElement(Tab1,{id:1,orgData:organization,errors:this.state.errors[0],switchTab:this.switchTab,valdiate:this.validateFields,typeRestriction:this.props.typeRestriction}),React.createElement(Tab2,{id:2,orgData:organization,errors:this.state.errors[1],switchTab:this.switchTab,valdiate:this.validateFields,typeRestriction:this.props.typeRestriction})))}}),Field=React.createClass({displayName:"Field",renderLabel:function(htmlFor,class_name,label,isRequired){var cn=isRequired?React.createElement("label",{className:"error"},"*"):"";return React.createElement("label",{htmlFor:htmlFor,className:class_name},label," ",cn)},render:function(){var className="control-label col-sm-3",classNameDiv="col-sm-7";return this.props.class_name&&(className=this.props.class_name),this.props.error&&(className+=" error"),this.props.class_name_div&&(classNameDiv=this.props.class_name_div),React.createElement("div",{className:"form-group"},this.renderLabel(this.props.name,className,t("my.network.organization."+this.props.name),this.props.isRequired),React.createElement("div",{className:classNameDiv},this.props.children))}}),iconClassName="control-label col-sm-2",Tab1=React.createClass({displayName:"Tab1",getInitialState:function(){return{organization:this.props.orgData,errors:[],errorMsg:""}},moveTabRight:function(){var errors=this.props.valdiate(this.state.organization);0==errors[0].length&&this.props.switchTab(this.props.id+1)},changeInput:function(fieldname,isCheckbox){return function(event){var org=this.state.organization;isCheckbox?org[fieldname]=event.target.checked:(org[fieldname]=event.target.value,"jurisdiction_uri"===fieldname&&(org.jurisdiction=event.added?event.added.name:"")),this.setState({organization:org})}.bind(this)},updateUploadedIcon:function(servedImageUrlData){var org=this.state.organization;org.iconUrl=servedImageUrlData,this.setState({organization:org,errorMsg:""})},error:function(xhr,status,err){this.setState({errorMsg:t("ui.unexpected_error")})},render:function(){-1!=$.inArray("icon",this.props.errors)&&(iconClassName+=" error"),this.state.organization=this.props.orgData;var label_regNum,sectorType=getSectorTypeLabel(this.state.organization.sector_type,this.props.typeRestriction),label_regOfficialId="",label_regActivity="",n=this.state.organization.country_uri?this.state.organization.country_uri.lastIndexOf("/"):-1,acronymCountry=n>0?this.state.organization.country_uri.substring(n+1):"";switch(acronymCountry){case"BG":label_regNum="tax_reg_num.bg",label_regActivity="tax_reg_activity.bg";break;case"IT":label_regNum="tax_reg_num.it",label_regActivity="tax_reg_activity.it";break;case"FR":label_regNum="tax_reg_num.fr",label_regOfficialId="tax_reg_ofical_id.fr",label_regActivity="tax_reg_activity.fr";break;case"ES":label_regNum="tax_reg_num.es",label_regActivity="tax_reg_activity.es";break;case"TR":label_regNum="tax_reg_num.tr",label_regOfficialId="tax_reg_ofical_id.tr",label_regActivity="tax_reg_activity.tr";break;default:label_regNum="tax_reg_num.en"}return React.createElement("div",{id:"tab1"},React.createElement("div",{className:"container-fluid"},React.createElement("div",{className:"row"},React.createElement("br",null),React.createElement("div",{className:"col-sm-15"},React.createElement(Field,{name:"legal_name",class_name:"control-label col-sm-2",error:-1!=$.inArray("legal_name",this.props.errors),isRequired:!0},React.createElement("input",{className:"form-control",id:"legal_name",type:"text",value:this.state.organization.legal_name,onChange:this.changeInput("legal_name"),disabled:this.state.organization.exist}),React.createElement("label",null,sectorType),React.createElement("label",{className:"col-sm-offset-3"},t("my.network.organization.in_activity"),":  ",React.createElement("input",{id:"in_activity",type:"checkbox",checked:this.state.organization.in_activity,onChange:this.changeInput("in_activity",!0)}))),React.createElement("br",null),React.createElement(Field,{name:"alt_name",class_name:"control-label col-sm-2"},React.createElement("input",{className:"form-control",id:"alt_name",type:"text",value:this.state.organization.alt_name,onChange:this.changeInput("alt_name")}))))," ",React.createElement("div",{className:"row"},React.createElement("div",{className:"col-sm-8"},React.createElement(Field,{name:"org_type",class_name_div:"col-sm-5"},React.createElement("input",{className:"form-control",id:"org_type",type:"text",value:this.state.organization.org_type,onChange:this.changeInput("org_type"),placeholder:t("my.network.organization.org_type.placeholder")})),React.createElement(Field,{name:label_regNum,error:-1!=$.inArray("tax_reg_num",this.props.errors),isRequired:!0},React.createElement("input",{className:"form-control",id:"tax_reg_num",type:"text",value:this.state.organization.tax_reg_num,onChange:this.changeInput("tax_reg_num"),disabled:!0})),""!==label_regOfficialId&&"COMPANY"!==this.state.organization.sector_type?React.createElement(Field,{name:label_regOfficialId},React.createElement("input",{className:"form-control",id:"tax_reg_ofical_id",type:"text",value:this.state.organization.tax_reg_ofical_id,onChange:this.changeInput("tax_reg_ofical_id")})):"",React.createElement(Field,{name:label_regActivity,class_name_div:"col-sm-3"},React.createElement(GeoSingleSelect2Component,{ref:"geoSearchtaxRegActivity",className:"form-control",name:"geoSearchRegActivity",onChange:this.changeInput("tax_reg_activity_uri"),urlResources:store_service+"/dc-taxRegActivity",countryFilter:{country_uri:this.state.organization.country_uri},placeholder:this.state.organization.tax_reg_activity_uri?this.state.organization.tax_reg_activity_uri.substring(this.state.organization.tax_reg_activity_uri.lastIndexOf("/")+1):" ",minimumInputLength:2})),React.createElement("br",null),"COMPANY"===this.state.organization.sector_type?"":React.createElement(Field,{name:"jurisdiction",error:-1!=$.inArray("jurisdiction_uri",this.props.errors),isRequired:!0},React.createElement(GeoSingleSelect2Component,{ref:"geoSearchJurisdiction",className:"form-control",name:"geoSearch",onChange:this.changeInput("jurisdiction_uri"),urlResources:store_service+"/geographicalAreas",countryFilter:{country_uri:this.state.organization.country_uri},placeholder:this.state.organization.jurisdiction})),React.createElement(Field,{name:"phone_number"},React.createElement("input",{className:"form-control",id:"phone_number",type:"text",value:this.state.organization.phone_number,onChange:this.changeInput("phone_number")})),React.createElement(Field,{name:"web_site"},React.createElement("input",{className:"form-control",id:"web_site",type:"text",value:this.state.organization.web_site,onChange:this.changeInput("web_site")})),React.createElement(Field,{name:"email"},React.createElement("input",{className:"form-control",id:"email",type:"email",value:this.state.organization.email,onChange:this.changeInput("email"),placeholder:t("my.network.organization.email.placeholder")}))),React.createElement("div",{className:"col-sm-2"},React.createElement("div",{className:"form-group"},React.createElement("div",{className:"control"},React.createElement("img",{src:this.state.organization.iconUrl}),React.createElement("div",{className:"btn btn-success-inverse btn-edit"},React.createElement("i",{className:"pull-left fa fa-pencil"}),React.createElement("label",null,t("my.network.organization.change-icon")),React.createElement(FileUploadInput,{className:"edit",uploadUrl:"/media/objectIcon/"+this.state.organization.tax_reg_num,success:this.updateUploadedIcon,error:this.error}))))))),React.createElement("div",{className:"error"},React.createElement("label",null,this.state.errorMsg)," "),React.createElement("button",{key:"next",className:"control pull-right btn btn-primary-inverse",onClick:this.moveTabRight},t("ui.next")))}}),isInteger=function(obj){return jQuery.isNumeric(obj)&&obj.indexOf(".")<0},Tab2=React.createClass({displayName:"Tab2",getInitialState:function(){return{organization:this.props.orgData,errors:[]}},moveTabLeft:function(){var errors=this.props.valdiate(this.state.organization);0==errors[1].length&&this.props.switchTab(this.props.id-1)},changeInput:function(fieldname,isNumericField){return function(event){this.changeInputAddress(fieldname,event.target.value,isNumericField)}.bind(this)},changeInputAddress:function(fieldname,value,isNumericField){var org=this.state.organization;isNumericField&&""!==value?org[fieldname]=isInteger(value)?value.trim():org[fieldname]:org[fieldname]=value,this.setState({organization:org})},render:function(){-1!=$.inArray("icon",this.props.errors)&&(iconClassName+=" error"),this.state.organization=this.props.orgData;var sectorType=getSectorTypeLabel(this.state.organization.sector_type,this.props.typeRestriction);return React.createElement("div",{id:"tab2"},React.createElement("div",{className:"container-fluid"},React.createElement("div",{className:"row"},React.createElement("br",null),React.createElement("div",{className:"col-sm-15"},React.createElement(Field,{name:"legal_name",class_name:"control-label col-sm-2",error:-1!=$.inArray("name",this.props.errors)},React.createElement("input",{className:"form-control",id:"legal_name",type:"text",value:this.state.organization.legal_name,onChange:this.changeInput("legal_name"),disabled:!0}),React.createElement("label",null,sectorType),React.createElement("label",{className:"col-sm-offset-3"},t("my.network.organization.in_activity"),":  ",React.createElement("input",{id:"in_activity",type:"checkbox",checked:this.state.organization.in_activity,disabled:!0}))),React.createElement("br",null)))," ",React.createElement("div",{className:"row"},React.createElement("div",{className:"col-sm-8"},React.createElement(AddressComponent,{errors:this.props.errors,addressContainer:this.state.organization,changeInput:this.changeInputAddress,addressType:"ORG",disabled:!0}))," ",React.createElement("div",{className:"col-sm-4"})))," ",React.createElement("button",{key:"next",className:"control pull-right btn btn-primary-inverse",onClick:this.moveTabLeft},t("ui.previous")))}}),AddressComponent=React.createClass({displayName:"AddressComponent",componentDidMount:function(){},changeInput:function(fieldname,isNumericField){return changeInput=this.props.changeInput,function(event){event.added?(changeInput(fieldname,event.added.name,isNumericField),changeInput(fieldname+"_uri",event.target.value,isNumericField)):"country"===fieldname?(changeInput(fieldname,event.target.selectedOptions[0].label,isNumericField),changeInput(fieldname+"_uri",event.target.value,isNumericField),changeInput("city","",isNumericField),changeInput("city_uri","",isNumericField),this.refs.geoSearchCity&&this.refs.geoSearchCity.clear()):changeInput(fieldname,event.target.value,isNumericField)}.bind(this)},render:function(){var address=this.props.addressContainer,addressType=this.props.addressType?this.props.addressType:"";return React.createElement("div",null,React.createElement(Field,{name:"street_and_number",error:-1!=$.inArray("street_and_number",this.props.errors),isRequired:"ORG"==addressType?!0:!1},React.createElement("input",{className:"form-control",id:"street_and_number",type:"text",value:address.street_and_number,onChange:this.changeInput("street_and_number")})),React.createElement(Field,{name:"additional_address_field"},React.createElement("input",{className:"form-control",id:"additional_address_field",type:"text",value:address.additional_address_field,onChange:this.changeInput("additional_address_field")})),"ORG"!==addressType?"":React.createElement(Field,{name:"po_box"},React.createElement("input",{className:"form-control",id:"po_box",type:"text",value:address.po_box,onChange:this.changeInput("po_box")})),React.createElement(Field,{name:"city",error:-1!=$.inArray("city",this.props.errors),isRequired:!0},React.createElement(GeoSingleSelect2Component,{ref:"geoSearchCity",className:"form-control",onChange:this.changeInput("city"),name:"geoSearchCity",urlResources:store_service+"/dc-cities",placeholder:address.city,countryFilter:{country_uri:address.country_uri}})),React.createElement(Field,{name:"zip",class_name_div:"col-sm-3",error:-1!=$.inArray("zip",this.props.errors),isRequired:!0},React.createElement("input",{className:"form-control",id:"zip",type:"text",maxLength:6,value:address.zip,onChange:this.changeInput("zip",!0)})),"ORG"!==addressType?"":React.createElement(Field,{name:"cedex",class_name_div:"col-sm-2"},React.createElement("input",{className:"form-control",id:"cedex",type:"cedex",maxLength:3,value:address.cedex,onChange:this.changeInput("cedex",!0)})),React.createElement(Field,{name:"country",class_name_div:"col-sm-5",error:-1!=$.inArray("country_uri",this.props.errors),isRequired:!0},React.createElement(CountrySelect,{className:"form-control",url:store_service+"/dc-countries",value:address.country_uri,onChange:this.changeInput("country"),disabled:this.props.disabled})))}});
