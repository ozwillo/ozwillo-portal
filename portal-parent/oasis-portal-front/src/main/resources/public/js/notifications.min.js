function t(key){if("undefined"!=typeof _i18n){var v=_i18n[key];if(null!=v)return v;if(v=_i18n["notif."+key],null!=v)return v}return key}var NotificationTable=React.createClass({displayName:"NotificationTable",getInitialState:function(){return{n:[],apps:[],recentlyRemoved:[],currentSort:{prop:"date",dir:-1},filter:{app:null,status:"UNREAD"}}},loadNotifications:function(){$.ajax({url:this.props.url,data:{status:this.state.filter.status},datatype:"json",success:function(data){var s=this.state,recentlyRemoved=s.recentlyRemoved,notifs=data.notifications.filter(function(notif){return-1==$.inArray(notif.id,recentlyRemoved)}),currentSort=s.currentSort;s.n=notifs.sort(function(a,b){return"number"==typeof a[currentSort.prop]?(a[currentSort.prop]-b[currentSort.prop])*currentSort.dir:a[currentSort.prop].localeCompare(b[currentSort.prop])*currentSort.dir}),s.apps=data.apps,this.setState(s)}.bind(this),error:function(xhr,status,err){}.bind(this)})},componentDidMount:function(){this.loadNotifications(),setInterval(this.loadNotifications,this.props.pollInterval)},sortBy:function(criterion){var component=this;return function(){var currentSort=component.state.currentSort,sortDirection=-1;currentSort.prop==criterion&&(sortDirection=-1*currentSort.dir),currentSort.prop=criterion,currentSort.dir=sortDirection;var n=component.state.n.sort(function(a,b){return"number"==typeof a[currentSort.prop]?(a[currentSort.prop]-b[currentSort.prop])*currentSort.dir:a[currentSort.prop].localeCompare(b[currentSort.prop])*currentSort.dir}),state=component.state;state.n=n,state.currentSort=currentSort,component.setState(state)}},filterByStatus:function(event){event.preventDefault();var state=this.state;state.filter.status=event.target.value,this.setState(state),this.loadNotifications()},filterByApp:function(event){event.preventDefault();var state=this.state,appId=event.target.value;"all"==appId&&(appId=null),state.filter.app=appId,this.setState(state)},removeNotif:function(id){var notifs=this.state.n.filter(function(n){return n.id!=id}),recentlyRemoved=this.state.recentlyRemoved;recentlyRemoved.push(id),this.setState({n:notifs,recentlyRemoved:recentlyRemoved}),$.ajax({url:this.props.url+"/"+id,method:"delete",datatype:"json",success:function(data){}.bind(this),error:function(xhr,status,err){}.bind(this)})},render:function(){var callback=this.removeNotif,appId=this.state.filter.app,notificationNodes=this.state.n.filter(function(notif){return null==appId?!0:notif.serviceId==appId}).map(function(notif){return React.createElement(Notification,{key:notif.id,notif:notif,onRemoveNotif:callback})});return 0==notificationNodes.length&&(notificationNodes=React.createElement("div",null,t("no-notification"))),React.createElement("div",null,React.createElement(NotificationHeader,{filter:this.state.filter,updateStatus:this.filterByStatus,updateAppFilter:this.filterByApp,apps:this.state.apps}),React.createElement("div",{className:"standard-form"},React.createElement("div",{className:"row form-table-header"},React.createElement(SortableHeader,{name:"date",label:"date",size:"2",sortBy:this.sortBy,sort:this.state.currentSort}),React.createElement(SortableHeader,{name:"appName",size:"2",label:"app",sortBy:this.sortBy,sort:this.state.currentSort}),React.createElement(SortableHeader,{name:"formattedText",label:"message",size:"6",sortBy:this.sortBy,sort:this.state.currentSort})),notificationNodes))}}),SortableHeader=React.createClass({displayName:"SortableHeader",render:function(){var className="col-sm-"+this.props.size+" sortable",sortIcon=React.createElement("i",{className:"fa fa-sort"});return this.props.sort.prop==this.props.name&&(sortIcon=-1==this.props.sort.dir?React.createElement("i",{className:"fa fa-sort-desc"}):React.createElement("i",{className:"fa fa-sort-asc"})),React.createElement("div",{className:className,onClick:this.props.sortBy(this.props.name)},t(this.props.label)," ",sortIcon)}}),NotificationHeader=React.createClass({displayName:"NotificationHeader",render:function(){return React.createElement("div",{className:"row"},React.createElement("h2",{className:"col-sm-3"},t("ui.notifications")),React.createElement("div",{className:"col-sm-9 text-right"},React.createElement("form",{className:"form-inline header-form"},React.createElement(AppFilter,{apps:this.props.apps,onChange:this.props.updateAppFilter}),React.createElement("span",{className:"spacer"}),React.createElement("select",{name:"status",className:"form-control",onChange:this.props.updateStatus},React.createElement("option",{value:"UNREAD"},t("unread")),React.createElement("option",{value:"READ"},t("read")),React.createElement("option",{value:"ANY"},t("any"))))))}}),AppFilter=React.createClass({displayName:"AppFilter",render:function(){var options=this.props.apps.map(function(app){return React.createElement("option",{key:app.id,value:app.id},app.name)});return React.createElement("select",{name:"app",className:"form-control",onChange:this.props.onChange},React.createElement("option",{value:"all"},t("all-apps")),options)}}),Notification=React.createClass({displayName:"Notification",removeNotif:function(){this.props.onRemoveNotif(this.props.notif.id)},render:function(){var action=null;return this.props.notif.url&&(action=React.createElement("a",{href:this.props.notif.url,target:"_new",className:"btn btn-primary"},this.props.notif.actionText)),React.createElement("div",{className:"row form-table-row"},React.createElement("div",{className:"col-sm-2"},this.props.notif.dateText),React.createElement("div",{className:"col-sm-2"},this.props.notif.appName),React.createElement("div",{className:"col-sm-6",dangerouslySetInnerHTML:{__html:this.props.notif.formattedText}}),React.createElement("div",{className:"col-sm-2"},action,React.createElement("a",{href:"#",className:"btn btn-primary",onClick:this.removeNotif},t("archive"))))}});React.renderComponent(React.createElement(NotificationTable,{url:notificationService,pollInterval:2e3}),document.getElementById("notifications"));
